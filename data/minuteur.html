<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <meta name="description" content="">
        <meta name="author" content="">
        <title>Pv Routeur  - minuteur Configuration</title>
        <!-- Custom styles for this template-->
        <link href="css/all.min.css" rel="stylesheet" type="text/css" />
        <script type="text/javascript" src="js/all.min.js" ></script>
    </head>
    <body id="page-top">
        <!-- Page Wrapper -->
        <div id="wrapper">
            <!-- Sidebar -->
            <ul class="navbar-nav bg-gradient-primary sidebar sidebar-dark accordion" id="accordionSidebar">
                <!-- Sidebar - Brand -->
                <a class="sidebar-brand d-flex align-items-center justify-content-center" href="/">
                    <div class="sidebar-brand-icon rotate-n-15">
                        <i class="fas fa-laugh-wink"></i>
                    </div>
                    <div class="sidebar-brand-text mx-3">Pv Routeur</div>
                </a>
                <!-- Divider -->
                <hr class="sidebar-divider my-0">
                <!-- Nav Item - Dashboard -->
                <li class="nav-item active">
                    <a class="nav-link" href="/">
                        <i class="fas fa-fw fa-tachometer-alt"></i>
                        <span>Dashboard</span>
                        <br>
                        <span id="version"></span>
                    </a>
                </li>
                <!-- Divider -->
                <hr class="sidebar-divider">
                <!-- Heading -->
                <div class="sidebar-heading">
                    Interface
                </div>
                <!-- Nav Item - Pages Collapse Menu -->
                <li class="nav-item active">
                    <a class="nav-link" href="/">
                        <i class="fas fa-fw fa-plug"></i>
                        <span>retour conso</span>
                    </a>
                </li>
                <li class="nav-item active">
                    <a class="nav-link" href="config.html">
                        <i class="fas fa-fw fa-cog"></i>
                        <span>Configuration</span>
                    </a>
                </li>
                <li class="nav-item active">
                    <a class="nav-link" href="/reboot">
                        <i class="fas fa-fw fa-power-off"></i>
                        <span>Reboot</span>
                    </a>
                </li>
                <!-- Divider -->
                <hr class="sidebar-divider d-none d-md-block">
                <!-- Sidebar Toggler (Sidebar) -->
                <div class="text-center d-none d-md-inline">
                    <button class="rounded-circle border-0" id="sidebarToggle"></button>
                </div>
            </ul>
            <!-- End of Sidebar -->
            <!-- Content Wrapper -->
            <div id="content-wrapper" class="d-flex flex-column">
                <!-- Main Content -->
                <div id="content">
                    <!-- Topbar -->
                    <nav class="navbar navbar-expand navbar-light bg-white topbar mb-4 static-top shadow">
 
          <!-- Topbar Navbar -->
                        <ul class="navbar-nav ml-auto">
                            <!-- Nav Item - Search Dropdown (Visible Only XS) -->
                            <li class="nav-item dropdown no-arrow d-sm-none">
                                <!-- Dropdown - Messages -->
                                <div class="dropdown-menu dropdown-menu-right p-3 shadow animated--grow-in" aria-labelledby="searchDropdown"></div>
                            </li>
                            <!-- Nav Item - Alerts -->
                            <li class="nav-item mx-1">
                                <a
                                    id="heure"
                                >
                                </a>
                            </li>
                            <div class="topbar-divider d-none d-sm-block"></div>
                        </ul>
                    </nav>
                    <!-- End of Topbar -->
                    <!-- Begin Page Content -->

          <div class="container-fluid">
            <!-- Page Heading -->
            <h1 class="h3 mb-2 text-gray-800">Configuration minuteur d'appoint</h1>
            <div class="col-lg-6">
              <div class="card">
                <div class="card-header">
                  <nav id="tabs">
                    <div class="nav nav-pills" id="nav-tab" role="tablist">
                      <button
                        class="nav-link active"
                        data-toggle="tab"
                        type="button"
                        role="tab"
                        data-target="#dimmer"
                        aria-controls="dimmer"
                        aria-selected="true"
                      >
                        Configuration dimmer
                      </button>
                      <button
                        class="nav-link"
                        data-toggle="tab"
                        type="button"
                        role="tab"
                        data-target="#batterie"
                        aria-controls="batterie"
                        aria-selected="true"
                      >
                        Configuration batterie
                      </button>
                      <button
                        class="nav-link"
                        data-toggle="tab"
                        type="button"
                        role="tab"
                        data-target="#relay1"
                        aria-controls="relay1"
                        aria-selected="false"
                      >
                        Configuration relais 1
                      </button>
                      <button
                        class="nav-link"
                        data-toggle="tab"
                        type="button"
                        role="tab"
                        data-target="#relay2"
                        aria-controls="relay2"
                        aria-selected="false"
                      >
                        Configuration relais 2
                      </button>
                    </div>
                  </nav>
                </div>
                <div class="tab-content">
                  <div role="tabpanel" class="card-body tab-pane fade show active" id="dimmer">
                    <form class="user" id="dimmer-form" method="post" action="">
                      <div class="form-group">
                        Heure de démarrage: (format hh:mm)
                        <input
                          type="text"
                          class="form-control form-control-user"
                          id="heure_demarrage_dimmer"
                          placeholder="HH:MM"
                        />
                      </div>
                      <div class="form-group">
                        Heure d'arrêt:
                        <input
                          type="text"
                          class="form-control form-control-user"
                          id="heure_arret_dimmer"
                          placeholder="HH:MM"
                        />
                      </div>
                      <div class="form-group">
                        Température de consigne (°C):
                        <input
                          type="number"
                          step="1"
                          class="form-control form-control-user"
                          id="temperature_dimmer"
                          placeholder="X (en °C)"
                        />
                      </div>
                      <div class="form-group">
                        Puissance de sortie (0-100&percnt;):
                        <input
                          type="number"
                          step="1"
                          class="form-control form-control-user"
                          id="puissance_dimmer"
                          placeholder="X (en &percnt;)"
                        />
                      </div>
                      <input
                        type="submit"
                        value="Application des paramètres dimmer"
                        class="btn btn-primary btn-user btn-block"
                      />
                    </form>
                  </div>
                  <div role="tabpanel" class="card-body tab-pane fade" id="batterie">
                    <form class="user" id="batterie-form" method="post" action="">
                      <div class="form-group">
                        Heure de démarrage: (format hh:mm)
                        <input
                          type="text"
                          class="form-control form-control-user"
                          id="heure_demarrage_batterie"
                          placeholder="HH:MM"
                        />
                      </div>
                      <div class="form-group">
                        Heure d'arrêt:
                        <input
                          type="text"
                          class="form-control form-control-user"
                          id="heure_arret_batterie"
                          placeholder="HH:MM"
                        />
                      </div>
                      <div class="form-group">
                        Température d'activation (°C):
                        <input
                          type="number"
                          step="1"
                          class="form-control form-control-user"
                          id="temperature_batterie"
                          placeholder="X (en °C)"
                        />
                      </div>
                      <div class="form-group">
                        Offset de delta batterie (décalage de -x W):
                        <input
                          type="number"
                          step="1"
                          class="form-control form-control-user"
                          id="puissance_batterie"
                          placeholder="X (en W)"
                        />
                      </div>
                      <input
                        type="submit"
                        value="Application des paramètres batterie"
                        class="btn btn-primary btn-user btn-block"
                      />
                    </form>
                    <h2>Minuteur spécifique pour la batterie :</h2>
                    <p>Ce minuteur permet de modifier le déclenchement de la régulation et de donner la priorité à la charge de la batterie lorsque la température dépasse la consigne.</p>

                    <h3>Fonctionnement :</h3>
                    <ul>
                      <li>Une valeur positive de puissance déplace les seuils Delta et Delta négatif de x Watts, favorisant ainsi la charge de la batterie, elle sera toujours soustraite </li>
                      <li>Une fois la batterie chargée, le routage vers l'ECS (Eau Chaude Sanitaire) reprendra jusqu'à atteindre la température maximale autorisée.</li>
                    </ul>

                    <h3>Recommandations :</h3>
                    <p>La valeur recommandée est de 100W. Une valeur inférieure peut entraîner un comportement imprévisible.</p>
                  </div>
                  <div role="tabpanel" class="card-body tab-pane fade" id="relay1">
                    <form class="user" id="relay1-form" method="post" action="">
                      <div class="form-group">
                        Heure de démarrage: (format hh:mm)
                        <input
                          type="text"
                          class="form-control form-control-user"
                          id="heure_demarrage_relay1"
                          placeholder="HH:MM"
                        />
                      </div>
                      <div class="form-group">
                        Heure d'arrêt:
                        <input
                          type="text"
                          class="form-control form-control-user"
                          id="heure_arret_relay1"
                          placeholder="HH:MM"
                        />
                      </div>
                      <div class="form-group">
                        Température de consigne (°C):
                        <input
                          type="number"
                          step="1"
                          class="form-control form-control-user"
                          id="temperature_relay1"
                          placeholder="X (en °C)"
                        />
                      </div>
                      <input
                        type="submit"
                        value="Application des paramètres relais 1"
                        class="btn btn-primary btn-user btn-block"
                      />
                    </form>
                  </div>
                  <div role="tabpanel" class="card-body tab-pane fade" id="relay2">
                    <form class="user" id="relay2-form" method="post" action="">
                      <div class="form-group">
                        Heure de démarrage: (format hh:mm)
                        <input
                          type="text"
                          class="form-control form-control-user"
                          id="heure_demarrage_relay2"
                          placeholder="HH:MM"
                        />
                      </div>
                      <div class="form-group">
                        Heure d'arrêt:
                        <input
                          type="text"
                          class="form-control form-control-user"
                          id="heure_arret_relay2"
                          placeholder="HH:MM"
                        />
                      </div>
                      <div class="form-group">
                        Température de consigne (°C):
                        <input
                          type="number"
                          step="1"
                          class="form-control form-control-user"
                          id="temperature_relay2"
                          placeholder="X (en °C)"
                        />
                      </div>
                      <input
                        type="submit"
                        value="Application des paramètres relais 2"
                        class="btn btn-primary btn-user btn-block"
                      />
                    </form>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- End of Page Content -->
        </div>
        <!-- End of Main Content -->
      </div>
      <!-- End of Content wrapper -->
    </div>
    <!-- Footer -->
    <footer class="sticky-footer bg-white">
      <div class="container my-auto">
        <div class="copyright text-center my-auto">
          <span>https://github.com/xlyric/ - 2025</span>
        </div>
      </div>
    </footer>
    <!-- End of Footer -->
    <script>
  $(document).ready(function() {
    // Récupération des heures de démarrage et d'arrêt depuis le serveur
    $.get("/getminuteur?relay2", function(data) {
      $("#heure_demarrage_relay2").val(data.heure_demarrage);
      $("#heure_arret_relay2").val(data.heure_arret);
      $("#temperature_relay2").val(data.temperature);
      // Affichage de l'heure au format 2 digits
      var heure = data.heure < 10 ? "0" + data.heure : data.heure;
      var minute = data.minute < 10 ? "0" + data.minute : data.minute;
      $("#heure").html( heure + ":" + minute );
    });

    $.get("/getminuteur?relay1", function(data) {
      $("#heure_demarrage_relay1").val(data.heure_demarrage);
      $("#heure_arret_relay1").val(data.heure_arret);
      $("#temperature_relay1").val(data.temperature);
    });

    $.get("/getminuteur?dimmer", function(data) {
      $("#heure_demarrage_dimmer").val(data.heure_demarrage);
      $("#heure_arret_dimmer").val(data.heure_arret);
      $("#temperature_dimmer").val(data.temperature);
      $("#puissance_dimmer").val(data.puissance);
      var heure = data.heure < 10 ? "0" + data.heure : data.heure;
      var minute = data.minute < 10 ? "0" + data.minute : data.minute;
      $("#heure").html( heure + ":" + minute );
    });

    $.get("/getminuteur?batterie", function(data) {
      $("#heure_demarrage_batterie").val(data.heure_demarrage);
      $("#heure_arret_batterie").val(data.heure_arret);
      $("#temperature_batterie").val(data.temperature);
      $("#puissance_batterie").val(data.puissance);
    });

    // Envoi des données de formulaire au serveur lors de la soumission du formulaire
    $("#dimmer-form").submit(function(event) {
      event.preventDefault();
      var heure_demarrage = $("#heure_demarrage_dimmer").val();
      var heure_arret = $("#heure_arret_dimmer").val();
      var temperature = $("#temperature_dimmer").val();
      var puissance = $("#puissance_dimmer").val();
      $.get("/setminuteur?dimmer", {"heure_demarrage": heure_demarrage, "heure_arret": heure_arret, "temperature": temperature, "puissance": puissance});
    });

    $("#batterie-form").submit(function(event) {
      event.preventDefault();
      var heure_demarrage = $("#heure_demarrage_batterie").val();
      var heure_arret = $("#heure_arret_batterie").val();
      var temperature = $("#temperature_batterie").val();
      var puissance = $("#puissance_batterie").val();
      $.get("/setminuteur?batterie", {"heure_demarrage": heure_demarrage, "heure_arret": heure_arret, "temperature": temperature, "puissance": puissance});
    });

    $("#relay1-form").submit(function(event) {
      event.preventDefault();
      var heure_demarrage = $("#heure_demarrage_relay1").val();
      var heure_arret = $("#heure_arret_relay1").val();
      var temperature = $("#temperature_relay1").val();
      $.get("/setminuteur?relay1", {"heure_demarrage": heure_demarrage, "heure_arret": heure_arret, "temperature": temperature});
    });

    $("#relay2-form").submit(function(event) {
      event.preventDefault();
      var heure_demarrage = $("#heure_demarrage_relay2").val();
      var heure_arret = $("#heure_arret_relay2").val();
      var temperature = $("#temperature_relay2").val();
      $.get("/setminuteur?relay2", {"heure_demarrage": heure_demarrage, "heure_arret": heure_arret, "temperature": temperature});
    });
  
  });

  // Récupération de l'heure depuis le serveur toutes les 15 secondes
  setInterval(function ( ) {
    $.getJSON('/getminuteur', function(data) {
        // Affichage de l'heure au format 2 digits
        var heure = data.heure < 10 ? "0" + data.heure : data.heure;
        var minute = data.minute < 10 ? "0" + data.minute : data.minute;
        $("#heure").html( heure + ":" + minute );
      });
	}, 15000);
</script>


</body>
</html>
